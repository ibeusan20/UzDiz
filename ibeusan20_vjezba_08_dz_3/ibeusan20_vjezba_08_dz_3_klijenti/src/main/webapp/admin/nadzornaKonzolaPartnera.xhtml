<ui:composition template="/predlozak.xhtml"
	xmlns:ui="jakarta.faces.facelets" xmlns:h="jakarta.faces.html"
	xmlns:f="jakarta.faces.core">

	<ui:define name="title">Zadaća 3 - Nadzorna konzola partnera/restoranaa</ui:define>
	<ui:define name="content">
		<h2>Nadzorna konzola partnera/restorana</h2>
		<br />
		<div>
			<p>
				Poruka: <span id="poruka"></span>
			</p>
		</div>
		<p>
			Otvorene narudžbe: <span id="otvoreneNarudzbe">?</span>
		</p>
		<p>
			Plaćeni računi: <span id="racuni">?</span>
		</p>
		<p>
			Status rada odgovor:
			<h:outputText value="#{nadzornaKonzolaPartnera.statusPoruka}" />
		</p>
		<p>
				Status rada: <span id="porukaBoja"></span>
		</p>
		<!-- <p>
			Status rada: <span id="statusPosluzitelja" style="font-weight: bold;">NEPOZNATO</span>
		</p>
		<p>Status rada: <span id="statusBoja">NEPOZNATO</span></p> -->

		<h:form>
			<h:panelGrid columns="2">
				<h:outputLabel value="ID partnera:" />
				<h:inputText value="#{nadzornaKonzolaPartnera.id}">
					<f:validateLongRange minimum="1" />
				</h:inputText>

			</h:panelGrid>
			<h:commandButton value="Status"
				action="#{nadzornaKonzolaPartnera.status}" />
			<h:commandButton value="Pauza"
				action="#{nadzornaKonzolaPartnera.pauza}" />
			<h:commandButton value="Start"
				action="#{nadzornaKonzolaPartnera.start}" />
			<h:commandButton value="Kraj"
				action="#{nadzornaKonzolaPartnera.kraj}" />
		</h:form>


		<script type="text/javascript">
			var wsocket;
			function connect() {
				var adresa = window.location.pathname;
				var dijelovi = adresa.split("/");
				adresa = "ws://" + window.location.hostname + ":"
						+ window.location.port + "/" + dijelovi[1]
						+ "/ws/partneri";
				if ('WebSocket' in window) {
					wsocket = new WebSocket(adresa);
				} else if ('MozWebSocket' in window) {
					wsocket = new MozWebSocket(adresa);
				} else {
					alert('WebSocket nije podržan od web preglednika.');
					return;
				}
				wsocket.onmessage = onMessage;
			}

			function onMessage(evt) {
				var poruka = evt.data;
				var dijelovi = poruka.split(";");
				document.getElementById("poruka").innerText = poruka;
				document.getElementById("otvoreneNarudzbe").innerText = dijelovi[1];
				document.getElementById("racuni").innerText = dijelovi[2];
				
				let status = dijelovi[0].trim();
				
				document.getElementById("porukaBoja").innerText = dijelovi[0].trim();
				const porukaElemBoja = document.getElementById("porukaBoja");
				porukaElemBoja.style.color = (status === "RADI") ? "green" : "red";
				
				
				const porukaElem = document.getElementById("poruka");
				porukaElem.style.color = (status === "RADI") ? "green" : "red";
			}

			window.addEventListener("load", connect, false);
		</script>
	</ui:define>
	<ui:define name="nav">
	</ui:define>
</ui:composition>